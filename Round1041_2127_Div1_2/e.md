Модоо ямар ч хамаагүй орой дээр үндэслээд, ямар нэг оройн хувьд хүүхэд дээр нь үндэстэй дэд модыг түүний хүүхэд мод гэе. Мөн $v$ орой ба $t$ өнгөний хувьд дараах нөхцөлийг хангавал $t$-г $v$-ийн хувьд тод өнгө гэе: тус бүр нь ядаж нэг $t$ өнгөтэй орой агуулсан байх 2 ялгаатай хүүхэд мод олдох

$v$ орой cutie байх нь $c_v$-ээс ялгаатай ядаж нэг тод өнгө ($v$-ийн хувьд) байхтай ижил. Тод өнгөгүй орой хэзээ ч cutie байж чадахгүй бол ядаж 2 тод өнгөтэй орой ямагт cutie байна. Харин яг 1 тод өнгөтэй бол зөвхөн тэр нь өөрөөс нь өөр өнгөтэй үед л cutie байна.

Ямар нэг cutie байх $v$ орой ба дэд модонд нь байх $u$ оройн хувьд хэрэв $u$-г тооцохгүй бол $v$ cutie байж чаддаггүй бол $u$ нь $v$-д гай болдог гэе. (энэ бодлогонд cutie биш байх нь ашигтай :)\
$u$ орой $v$-д гай болдог гэвэл $u$-г агуулсан $v$-ийн хүүхэд модонд $u$-тай адилхан өнгөтэй өөр орой байж болохгүй болно. (хэрэв байдаг бол $u$-ийн оронд тэрийг нь сонгож болох учраас $v$ нь cutie байхад $u$ зайлшгүй хэрэгтэй биш бөгөөд иймд $u$ нь $v$-д гай болохгүй). Эндээс цаашлаад $u$ нь өөрийнхөө үр удмаас бүгдэнгээс нь өөр өнгөтэй байх ёстой болно. Харин ийм байх нь өөрт нь сайн зүйл биш. Яагаад гэвэл, яг нэг тод өнгөтэй бол (бусад тохиолдолд cutie байх эсэх нь өөрийнх нь өнгөнөөс хамаарахгүй) уг нь өөрөө тийм өнгөтэй байсан бол cutie биш байх байсан. Эндээс бусдаас содон өнгөтэй байх нь ямар ч ашиггүй нь харагдаж байна.

Одоо харин өнгөгүй оройнуудаа бусдад аль болох гай болохгүйгээр бас өөрөө болж өгвөл cutie биш байхаар яаж будахаа бодъё. dfs хийгээд өөрийнх нь хүүхдүүдээр ороод гарсных нь дараа тухайн оройг ямар өнгөөр будахаа шийдье. Яагаад гэвэл ингэвэл бүх үр удмынхаа өнгөнүүдийг мэдчихсэн байх болно. Ингэхдээ энэ дээрх шиг https://usaco.guide/plat/merging#better-solution байдлаар нийт $O(n \log^2 n)$ хугацаанд өөрийнхөө үр удмын өнгөнүүдыг мэдэхээс гадна тод өнгөнүүдээ олж чадна. Ингээд олсны дараа хэрэв яг 1 тод өнгөтэй бол тэр өнгөөр нь будчихаж болно. (өөрөө cutie биш байх ба бусдад ч гай болохгүй) Харин бусад тохиолдолд түүний cutie байх эсэх нь өөрийнх нь өнгөнөөс хамаарахгүй ба бусдад гай болохгүй гэсэн үүднээс дурын хүүхэдтэй нь адилхан өнгөөр будахад хангалттай. Гэвч ингэвэл навч оройн хувьд ямар өнгөөр будахаа мэдэхгүй. Харин ингэж хүүхэдтэй нь адилхан өнгөөр будахын оронд эцэгтэй нь адилхан өнгөөр будахад ч бас хэнд ч гай болохгүй гэдгийг харж болно. Эцэг нь өнгөгүй үед бас ямар өнгөөр будахаа мэдэхгүй боловч энэ оройг сүүлд нь будна гэж бодоод цаашдаа түүнийг огт байхгүй гэж сэтгэхэд болно. Ингээд dfs дууссаны дараа дахиж dfs хийгээд өнгөгүй үлдсэн оройнууд буюу эцэгтэй нь адилхан будна гээд үлдээснүүдээ будахад болно. Ингэхэд dfs эхлүүлсэн орой буюу үндсийг нь ямар өнгөөр будахаа мэдэхгүй ч гэсэн ямар ч хамаагүй өнгөөр будчихад болно. Ингээд бүгдийг нь будахад зөвхөн заавал cutie байх ёстойнууд нь л cutie болж дуусах тул оновчтой байх нь гарцаагүй.

**Time complexity: $O(n \log^2 n)$**\
[Submission](https://codeforces.com/contest/2127/submission/332854671)
